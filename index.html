<!DOCTYPE html>
<html lang="km">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Riverland International School</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"
    />
<link href="https://fonts.googleapis.com/css2?family=Moul&display=swap" rel="stylesheet">

    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: "Noto Sans Khmer", sans-serif;
        background: linear-gradient(to bottom right, #0f2027, #71c7e4, #2c5364);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .container {
        background: #fff;
        color: #142286;
        width: 90%;
        max-width: 400px;
        border-radius: 15px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
        text-align: center;
        padding: 30px 20px;
      }
      img {
        width: 120px;
        margin-bottom: 10px;
      }
      h1 {
        font-size: 24px;
        font-family: "Moul", serif;
        color: #0d3896;
        margin: 0;
      }
      p {
        font-size: 24px;
        color: #ff4d4d;
        margin: 0 0 30px 0;
      }
      .button-container {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 20px;
      }
      .digital-button {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 10px;
        background: linear-gradient(145deg, #004e92, #0a92d1);
        color: #fff;
        border: none;
        border-radius: 20px;
        width: 140px;
        height: 140px;
        font-size: 15px;
        font-weight: bold;
        text-decoration: none;
        transition: transform 0.25s ease, box-shadow 0.25s ease;
        box-shadow: 0 8px 20px rgba(0, 114, 255, 0.4);
      }
      .digital-button:hover {
        transform: translateY(-6px);
        background: linear-gradient(145deg, #66e0f0, #04c0a1);
        box-shadow: 0 12px 24px rgba(255, 75, 43, 0.5);
      }
      .icon {
        font-size: 40px;
      }
      .credit {
        margin-top: 20px;
        font-size: 13px;
        color: #aaa;
        font-family: "Rowdies", sans-serif;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <img src="Logo1.PNG" alt="Logo សាលា" />
      <h1>សាលាអន្តរជាតិ​ រីវើឡែនឌ៏</h1>
      <p>Riverland International School</p>

      <div class="button-container">
        <a href="#" id="attendanceBtn" class="digital-button">
          <i class="fas fa-user-check icon"></i>
          ចុះវត្តមាន
        </a>
        <a href="https://forms.gle/Vy8tS9kn6CdXtQjh7" class="digital-button">
          <i class="fas fa-file-signature icon"></i>
          សុំច្បាប់
        </a>
      </div>

      <div class="credit">Created by Srean Phirom</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
      const normalForm = "https://forms.gle/VzJkUtFtwmsksSa48";
      const lateForm = "https://forms.gle/oYbGM2zYvVoTVC2eA";

      function getAttendanceFormByTime() {
        const now = new Date();
        const minutes = now.getHours() * 60 + now.getMinutes();

        // Morning
        if (minutes >= 360 && minutes <= 455) return "normal"; // 6:00-7:35
        if (minutes >= 456 && minutes <= 599) return "late"; // 7:36-9:59
        if (minutes >= 600 && minutes <= 719) return "normal"; //10:00-11:59
        // Afternoon
        if (minutes >= 720 && minutes <= 815) return "normal"; //12:00-13:35
        if (minutes >= 816 && minutes <= 899) return "late"; //13:36-14:59
        if (minutes >= 900 && minutes <= 1079) return "normal"; //15:00-17:59
        return "closed";
      }

      document
        .getElementById("attendanceBtn")
        .addEventListener("click", function (e) {
          e.preventDefault();

          // Check GPS permission
          navigator.permissions
            .query({ name: "geolocation" })
            .then(function (result) {
              if (result.state === "denied") {
                Swal.fire(
                  "❌ GPS Disabled",
                  "សូមបើក Location នៅ browser",
                  "error"
                );
                return;
              }

              Swal.fire({
                title: "កំពុងចាប់ទីតាំង...",
                text: "សូមរងចាំ...",
                allowOutsideClick: false,
                didOpen: () => Swal.showLoading(),
              });

              navigator.geolocation.getCurrentPosition(
                (pos) => {
                  Swal.close();
                  const lat = pos.coords.latitude;
                  const lng = pos.coords.longitude;

                  const mode = getAttendanceFormByTime();

                  if (mode === "normal") {
                    window.location.href = normalForm;
                  } else if (mode === "late") {
                    Swal.fire({
                      title: "⏰ មកយឺត!",
                      text: "សូមបំពេញបែបបទ I'm Late",
                      icon: "warning",
                      confirmButtonText: "OK",
                    }).then(() => (window.location.href = lateForm));
                  } else {
                    Swal.fire({
                      title: "⏰ ក្រៅម៉ោងធ្វើការ!",
                      text: "មិនអាចចុះវត្តមានបានទេ",
                      icon: "error",
                      confirmButtonText: "OK",
                    });
                  }
                },
                (err) => {
                  Swal.fire(
                    "⚠️ មិនអាចចាប់ទីតាំងបាន!",
                    "សូមព្យាយាមម្តងទៀត",
                    "warning"
                  );
                },
                { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
              );
            });
        });
    </script>
  </body>
</html>
